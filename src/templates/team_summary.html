"% include 'header.html' %"

<main class="container pt-3">
    <div class="row sticky-top" v-cloak>
        <div class="col-12 mb-3">
            <div class="card border-dark bg-squad-card text-white">
                <div class="card-body text-center p-3">


                    <div class="row no-gutters">
                        <!-- <div class="col-6 col-sm-4 col-md" v-cloak v-if="is_active">
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Active GW</div>
                                <div class="setting-value text-center p-0">
                                    <span style="color: orange">{{ active_gw }}</span>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-6 col-sm-4 col-md" v-cloak>
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Gameweek</div>
                                <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                    <ul class="d-flex flex-row setting-line mb-0 p-0" v-cloak data-toggle="modal" data-target="#dateModal">
                                        <!-- <li class="nav-item breadcrumb-item">{{ season }}</li> -->
                                        <li class="nav-item breadcrumb-item">{{ gw }}</li>
                                        <!-- <li class="nav-item breadcrumb-item">{{ date }}</li> -->
                                    </ul>
                                    <span style="color: orange" class="ml-2" v-if="is_active && gw.slice(2) == active_gw">(Live)</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-sm-4 col-md" v-cloak>
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Ownership Data</div>
                                <div class="setting-value text-center p-0">
                                    <div class="d-flex flex-row setting-line mb-0 p-0" v-cloak data-toggle="modal" data-target="#sourceModal">
                                        {{ ownership_source }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-sm-4 col-md" v-cloak v-if="is_using_sample">
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Captain/Chips</div>
                                <div class="setting-value text-center p-0">
                                    <span class="setting-line" v-cloak @click="toggleCaptaincy">
                                        {{ captaincy_enabled ? "Enabled" : "Disabled"}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-sm-4 col-md" v-cloak>
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Team</div>
                                <div class="setting-value text-center p-0">
                                    <div class="d-flex flex-row setting-line mb-0 p-0" v-cloak data-toggle="modal" data-target="#teamModal">
                                        {{ valid_team_id }} <span style="color: orange" class="ml-2" v-if="!(using_last_gw_team) && team_data.active_chip !== undefined && team_data.active_chip !== null">{{ team_data.active_chip ? "(" + (team_data.active_chip).toUpperCase() + ")": "" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-sm-4 col-md" v-cloak v-if="is_ready">
                            <div class="d-flex flex-column metric">
                                <div class="text-center p-0">Custom Input</div>
                                <div class="setting-value text-center p-0">
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle bg-none m-0 p-0 settings-button" type="button" id="generalOptions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                          Options
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenu3">
                                            <button class="dropdown-item btn btn-secondary btn-sm" type="button" @click="startEditTable">Edit Values</button>
                                            <button class="dropdown-item btn btn-secondary btn-sm" type="button" @click="clearOverridden">Clear User Inputs</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" v-cloak>
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">GW Overview - Expectation</h5>
                <!-- <div class="scenario_detail">Status of the selection using the data available before the deadline.</div> -->
                <div class="card-body">
                    <div v-if="is_ready">
                        <div class="row">
                            <div class="col-12 col-sm-6 mb-3">
                                <h6>Expected Gain / Loss Analysis</h6>
                                <div class="explanation text-small">Shows the relative <b>expected</b> gain and loss compared to rest of FPL managers.<br/> x-axis show the relative gain by having the player in your lineup, y-axis shows the relative loss by not having the player.<br/> Bubble
                                    size shows the price of the player before the deadline.<br/><span v-if="!is_using_captain">These values exclude captaincy.</span>
                                </div>
                                <div id="xp_own_prior" class="plot dark-plot mb-3">

                                </div>
                                <div class="input-group mb-1 p-4">
                                    <input type="text" class="form-control" id="playerNameFilter" placeholder="Filter player name" v-model="player_filter" @change="refresh_plots">
                                </div>
                                <div class="explanation text-small">
                                    Click on gray or red colored players to swap them into your squad. Use `Lineup` button to set your starting lineup.
                                </div>
                            </div>
                            <div class="col-12 col-sm-6">
                                <div class="mx-auto d-flex justify-content-center mb-2">
                                    <button class="btn btn-secondary btn-sm mr-3" @click='$("#lineupModal").modal("show")'>Lineup</button>
                                    <!-- <button class="btn btn-secondary btn-sm mr-1" @click="loadOptimal">Load Optimal</button><sup><a href="#" data-toggle="tooltip" data-placement="top" title="Best lineup under 100M budget">[?]</a></sup> -->
                                    <button class="btn btn-secondary btn-sm mr-3" @click='openTransfer'>Transfer</button>

                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="lineupOperations" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Operations
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                            <button class="dropdown-item btn btn-secondary btn-sm" type="button" @click="saveSquadToFile">Save Squad to File</button>
                                            <button class="dropdown-item btn btn-secondary btn-sm" type="button" @click="loadSquadFromFile">
                                                <label style="cursor: pointer; margin-bottom: 0px;" for="loadFile">Load Squad from File</label>
                                            </button>
                                            <input type="file" id="loadFile" style="display:none;" @change="loadSquadFromFile($event)" />
                                            <!-- <button class="dropdown-item btn btn-secondary btn-sm" type="button">Load Squad from Text</button> -->
                                            <div class="dropdown-divider"></div>
                                            <button class="dropdown-item btn btn-secondary btn-sm" type="button" @click="loadOptimal">Load Optimal</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="xP_prior_table">
                                    <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1" id="prior_table">
                                        <thead>
                                            <tr>
                                                <th class="text-muted">ID</th>
                                                <th></th>
                                                <th>Name</th>
                                                <th>Pos</th>
                                                <th class="text-right">xP</th>
                                                <th class="text-right">Exp. Gain</th>
                                                <th class="text-right">Exp. Loss</th>
                                                <th class="text-right">Own%</th>
                                            </tr>
                                        </thead>
                                        <tbody v-cloak>
                                            <tr v-for="i in prior_data_lineup" class="owned-row">
                                                <td class="text-muted">{{ i[1].player_id }}</td>
                                                <td :class="{'captain_color': is_using_captain && i[1].captain }">{{ is_using_captain ? (i[1].captain? (i[1].multiplier == 3 ? "TC" : "C") : "L") : "L" }}</td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i[1].player_id">{{ i[1].web_name }}</span></td>
                                                <td>{{ element_type[i[1].element_type]['short'] }}</td>
                                                <td class="text-right">{{ rounded(i[1].points_md) }}{{ is_using_captain && i[1].multiplier > 1 ? " (x" + i[1].multiplier + ")": "" }}</td>
                                                <template>
                                                    <td class="text-right" style="color: orange" v-if="is_using_captain && i[1].captain">{{ getWithSign(i[1].xp_owned_captain ) }}</td>
                                                    <td class="text-right" style="color: #acc3c5" v-else>{{ getWithSign(i[1].xp_owned) }}</td>
                                                </template>
                                                <td class="text-right text-muted">{{ getWithSign(i[1].xp_non_owned) }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }}</td>
                                            </tr>
                                            <tr v-for="i in prior_data_bench" class="bench-row">
                                                <td class="text-muted">{{ i[1].player_id }}</td>
                                                <td>B</td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i[1].player_id">{{ i[1].web_name }}</span></td>
                                                <td>{{ element_type[i[1].element_type]['short'] }}</td>
                                                <td class="text-right">{{ rounded(i[1].points_md) }}</td>
                                                <td class="text-right text-muted">{{ getWithSign(i[1].xp_owned) }}</td>
                                                <td class="text-right" style="color: #9d91a5">{{ getWithSign(i[1].xp_non_owned) }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }}</td>
                                            </tr>
                                            <tr v-for="i in prior_data_danger" class="nonowned-row">
                                                <td class="text-muted">{{ i[1].player_id }}</td>
                                                <td></td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i[1].player_id">{{ i[1].web_name }}</span></td>
                                                <td>{{ element_type[i[1].element_type]['short'] }}</td>
                                                <td class="text-right">{{ rounded(i[1].points_md) }}</td>
                                                <td class="text-right text-muted">{{ getWithSign(i[1].xp_owned) }}</td>
                                                <td class="text-right" style="color: #ff8763">{{ getWithSign(i[1].xp_non_owned) }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }}</td>
                                            </tr>
                                            <tr>
                                                <td colspan=5><b>Overall Gain - Lineup</b></td>
                                                <td class="text-right">{{ getWithSign(lineup_xp_sum) }}</td>
                                                <td></td>
                                                <td class="text-right">{{ (lineup_own_sum/11).toFixed(1) }}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan=5><b>Overall Gain - Squad</b></td>
                                                <td class="text-right">{{ getWithSign(squad_xp_sum) }}</td>
                                                <td></td>
                                                <td class="text-right">{{ (squad_own_sum/15).toFixed(1) }}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan=5><b>Overall Loss - All Players</b></td>
                                                <td></td>
                                                <td class="text-right">{{ rest_xp_sum }}</td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                            <div class="col-12 mt-2">
                                <div class=" bg-dark p-3 text-small">
                                    <div class="d-block mx-auto text-center mb-1 border-bottom">Expected Net <span class="own-color">Gain</span> (Lineup): {{ lineup_xp_sum }} <br/> Expected Net <span class="danger-color">Loss</span> (Rest): {{ rest_xp_sum }}</div>
                                    <div class="d-block mx-auto text-center mt-1">Expected Net Change: {{ getWithSign(net_change) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" v-cloak>
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">GW Overview - Realization</h5>
                <!-- <div class="scenario_detail">Status of the selection using the data after GW is played.</div> -->
                <div class="card-body">
                    <div v-if="is_ready">
                        <div class="row" v-if="rp_ready">
                            <div class="col-12 col-sm-6 mb-3">
                                <h6>Net Gain / Loss Analysis</h6>
                                <div class="explanation text-small">Shows the relative <b>net</b> gain and loss.<br/> x-axis show the relative gain by having the player in your lineup, y-axis shows the relative loss by not having the player.<br/> Bubble size shows the price of the player
                                    before the deadline.<br/><span v-if="!is_using_captain">These values exclude captaincy.</span>
                                </div>
                                <div id="xp_own_posterior" class="plot dark-plot">

                                </div>
                            </div>
                            <div class="col-12 col-sm-6">
                                <div class="mx-auto text-center d-block mb-2">
                                    <button class="btn btn-secondary btn-sm" @click='refresh_gw'>Refresh</button>
                                </div>
                                <div id="xP_posterior_table">
                                    <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1" id="posterior_table">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Name</th>
                                                <th>Pos</th>
                                                <th class="text-right">xP</th>
                                                <th class="text-right">rP</th>
                                                <th class="text-right">Own%</th>
                                                <th class="text-right">Exp</th>
                                                <th class="text-right">Net</th>
                                            </tr>
                                        </thead>
                                        <tbody v-cloak>
                                            <tr v-for="i in prior_data.filter(j => j[1].lineup)" class="owned-row">
                                                <td :class="{'captain_color': is_using_captain && i[1].captain }">{{ is_using_captain ? (i[1].captain? (i[1].multiplier == 3 ? "TC" : "C") : "L") : "L" }}</td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i[1].player_id">{{ i[1].web_name }}</span></td>
                                                <td>{{ element_type[i[1].element_type]['short'] }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].points_md).toFixed(2) }}{{ is_using_captain && i[1].multiplier > 1 ? " (x" + i[1].multiplier + ")": "" }}</td>
                                                <td class="text-right">{{ i[1].stats.total_points }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }}</td>
                                                <template v-if="is_using_captain && i[1].captain">
                                                    <td class="text-right">{{ getWithSign(i[1].net_xp) }}</td>
                                                    <td class="text-right" class="captain_color">{{ getWithSign(i[1].net_benefit) }}</td>
                                                </template>
                                                <template v-else>
                                                    <td class="text-right">{{ getWithSign(i[1].net_xp) }}</td>
                                                    <td class="text-right" style="color: #acc3c5">{{ getWithSign(i[1].net_benefit) }}</td>
                                                </template>

                                            </tr>
                                            <tr v-for="i in prior_data.filter(j => j[1].squad && !j[1].lineup)" class="bench-row">
                                                <td>B</td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i[1].player_id">{{ i[1].web_name }}</span></td>
                                                <td>{{ element_type[i[1].element_type]['short'] }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].points_md).toFixed(2) }}</td>
                                                <td class="text-right">{{ i[1].stats.total_points }}</td>
                                                <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }}</td>
                                                <td class="text-right">{{ getWithSign(i[1].net_xp) }}</td>
                                                <td class="text-right" style="color: #9d91a5">{{ getWithSign(i[1].net_benefit) }}</td>
                                            </tr>
                                            <tr v-for="i in sorted_posterior.rest.slice(0,5)" class="nonowned-row">
                                                <td></td>
                                                <td><span class="clickable_username" @click="openPlayerDetails" :data-id="i.player_id">{{ i.web_name }}</span></td>
                                                <td>{{ element_type[i.element_type]['short'] }}</td>
                                                <td class="text-right">{{ parseFloat(i.points_md).toFixed(2) }}</td>
                                                <td class="text-right">{{ i.stats.total_points }}</td>
                                                <td class="text-right">{{ parseFloat(i.ownership).toFixed(1) }}</td>
                                                <td class="text-right">{{ getWithSign(i.net_xp) }}</td>
                                                <td class="text-right" style="color: #ff8763">{{ getWithSign(i.net_benefit) }}</td>
                                            </tr>
                                            <!-- <tr>
                                                <td colspan=3><b>Overall-Lineup</b></td>
                                                <td>+{{ lineup_xp_sum }}</td>
                                                <td></td>
                                                <td>{{ (lineup_own_sum/11).toFixed(1) }}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan=3><b>Overall-Squad</b></td>
                                                <td>+{{ squad_xp_sum }}</td>
                                                <td></td>
                                                <td>{{ (squad_own_sum/15).toFixed(1) }}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan=3><b>Overall-Rest</b></td>
                                                <td></td>
                                                <td>{{ rest_xp_sum }}</td>
                                                <td></td>
                                            </tr> -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-12 mt-2">
                                <div class=" bg-dark p-3">
                                    <table class="table text-white mt-1 mb-1 shrink-table mx-auto text-small table-sm">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th class="text-right">Expected</th>
                                                <th class="text-right" v-if="is_live_gw">Expected<br/>(Live)</th>
                                                <th class="text-right">Realized</th>
                                                <th class="text-right">Played</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Gain</td>
                                                <td class="text-right">{{ (aftermath.exp_gain).toFixed(2) }}</td>
                                                <td class="text-right" v-if="is_live_gw">{{ (aftermath.exp_gain_live).toFixed(2) }}</td>
                                                <td class="text-right">{{ (aftermath.real_gain).toFixed(2) }}</td>
                                                <td class="text-right">{{ aftermath.played_own }}</td>
                                            </tr>
                                            <tr>
                                                <td>Loss</td>
                                                <td class="text-right">{{ (aftermath.exp_loss).toFixed(2) }}</td>
                                                <td class="text-right" v-if="is_live_gw">{{ (aftermath.exp_loss_live).toFixed(2) }}</td>
                                                <td class="text-right">{{ (aftermath.real_loss).toFixed(2) }}</td>
                                                <td class="text-right">{{ aftermath.played_nonown }}</td>
                                            </tr>
                                            <tr>
                                                <td><b>Net</b></td>
                                                <td class="text-right">{{ getWithSign(net_change) }}</td>
                                                <td class="text-right" v-if="is_live_gw">{{ getWithSign(aftermath.exp_gain_live-aftermath.exp_loss_live) }}</td>
                                                <td class="text-right"><b class="important-value">{{ getWithSign(aftermath.real_gain-aftermath.real_loss) }}</b></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <!-- <div class="d-block mx-auto text-center m-3">Expected Gain: {{ (aftermath.net_xp).toFixed(2) }} / Realized Gain: {{ (aftermath.net_rp).toFixed(2) }}</div>
                                    <div class="d-block mx-auto text-center m-3">Expected Loss: {{ (aftermath.fpl_xp).toFixed(2) }} / Realized Loss: {{ (aftermath.fpl_rp).toFixed(2) }}</div>
                                    <hr style="background-color: white" />
                                    <div class="d-block mx-auto text-center m-3">Realized Net Change: {{ (aftermath.net_rp-aftermath.fpl_rp).toFixed(2) }}</div> -->
                                </div>
                            </div>
                        </div>
                        <div class="row" v-else>
                            <div class="col-12">
                                <div class="mx-auto text-center d-block">
                                    GW is not played yet!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="row" v-cloak>
        <div class="col-12 mb-3">
            <div class="card border-dark bg-squad-card text-white qa">
                <div class="card-body text-left">
                    <h5>Q/A</h5>
                    <b>What is the source of expected values?</b>
                    <p class="answer"><a href="https://fplreview.com">FPL Review</a>. If you have any questions about the data accuracy, etc... you can find him on <a href="https://twitter.com/fplreview">Twitter</a>.</p>
                    <b>How do you calculate expected gain and expected loss?</b>
                    <p>Expected gain is calculated using (Expected Points) * (1-Ownership Ratio). Similarly expected loss is (Expected Points) * (Ownership Ratio).<br/>The logic behind this calculation is simple: if you have a player, you are at an advantage
                        as much as how many people don't own the player. If a player has xP of 6 and no one owns him, you get +6 compared to others. If ownership at 75%, your gain is averaged at 6*(25%)=1.5. Similarly, if you do not own the same player,
                        then your net loss will be 6*(75%)=-4.5.</p>
                    <b>There is a significant difference between "FPL API" and "Sample - Overall" expected loss values. What is the reason?</b>
                    <p>FPL API does not show whether owned players are on the bench or on the starting lineup. When using FPL API values, we consider all players of other managers as if all of their players are playing. For the sampling methods, we only
                        use other managers' starting lineup, which should be a better approximation.</p>
                    <b>My realized points differ from these values here.</b>
                    <p>Since FPL Official API does not release captaincy ratios, points coming from captains are excluded. I'm planning add them for sampling methods soon.</p>
                    <b>Why some of the players are marked red color?</b>
                    <p>Players in your squad are marked light blue, while biggest threats (5 players) to your team is marked red/orange.</p>
                    <b>What is the point of this analysis?</b>
                    <p>I use an optimization model for all of my FPL decisions, no manual decisions are allowed. So, I needed to a way to evaluate if all is working well with algorithm. I was doing this analysis for some time now, but decided to automate
                        it. While I'm at it, I wanted to share it with rest of FPL managers.</p>
                    <b>Sometimes page is loading very slow.</b>
                    <p>FPL API does not allow direct connection, so I'm using a CORS proxy. Depending on the load, proxy could be very slow sometimes.</p>
                </div>
                <div class="card-footer text-white disclaimer">
                    The information contained on this website is for general information purposes only. Any reliance you place on this information is strictly at your own risk.
                </div>
            </div>
        </div>
    </div>

</main>

<div class="modal" tabindex="-1" role="dialog" id="dateModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Choose a date</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <select class="form-control" v-model="seasongwdate" @change="close_date">
                        <option v-for="i in listdates">{{ i }}</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="sourceModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Choose a data source</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <select class="form-control" v-model="ownership_source" @change="changeData(); close_source_modal();">
                        <option  v-for="i in availableDataSources">{{ i }}</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="teamModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Enter team ID</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="number" class="form-control" id="teamIdEnter" v-model="current_team_id">
                </div>
                <div>
                    <div class="form-group text-black">
                        <label for="fpl_analytics_league_select">-OR- Choose a team among FPL Analytics League</label>
                        <select class="form-control" id="fpl_analytics_league_select" @change="selectLeagueTeam">
                            <option></option>
                            <option v-for="i in league_list" :value="i.id">{{ i.twitter }}</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" @click="saveTeamId">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="waitModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Fetching team values...</h5>
            </div>
            <div class="modal-body">
                <div class="p-2 wait-modal">
                    Fetching team picks from FPL website. Please wait... <br/>
                    <img class="mx-auto d-block" src="static/images/loading.svg">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="gwModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Fetching GW values...</h5>
            </div>
            <div class="modal-body">
                <div class="p-2 wait-modal">
                    Updating GW points from FPL website. Please wait... <br/>
                    <img class="mx-auto d-block" src="static/images/loading.svg">
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="singlePlayerDetailModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Player Details: <span style="color: darkred">{{ chosen_player.web_name }}</span>
                    <span class="ml-1">
                        <button class="btn btn-secondary btn-sm mb-1" @click="openSwapModel" v-if="!chosen_player.squad">
                            Transfer In
                        </button>
                    </span>
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-small" v-if="is_ready && !(_.isEmpty(chosen_player))">
                <fieldset class="popup_info_small top_field">
                    <legend>Info</legend>

                    <div class="row no-gutters">
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Team</div>
                                <div class="player-info-value text-center p-0">
                                    {{ team_codes[app.chosen_player.team_code].name }}
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Position</div>
                                <div class="player-info-value text-center p-0">
                                    {{ element_type[app.chosen_player.element_type].name }}
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Price</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player.price }}
                                </div>
                            </div>
                        </div>
                    </div>


                </fieldset>

                <fieldset class="popup_info_small top_field">
                    <legend>Values (Editable)</legend>

                    <div class="row no-gutters">
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Ownership</div>
                                <div class="player-info-value text-center p-0">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" v-model.lazy="chosen_player_ownership" @blur="changeData">
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="basic-addon2">%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Exp Points</div>
                                <div class="player-info-value text-center p-0">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" v-model.lazy="chosen_player_xp" @blur="changeData">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Real Points</div>
                                <div class="player-info-value text-center p-0">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" v-model.lazy="chosen_player_rp" @blur="changeData">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="popup_info_small top_field">
                    <legend>Stats</legend>

                    <div class="row no-gutters">
                        <div class="col-6" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Exp. Gain / Loss</div>
                                <div class="player-info-value text-center p-0">
                                    {{ getWithSign(chosen_player_detail.xp_owned) }} / {{ getWithSign(chosen_player_detail.xp_non_owned) }}
                                </div>
                            </div>
                        </div>
                        <div class="col-6" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Real Gain / Loss</div>
                                <div class="player-info-value text-center p-0">
                                    {{ getWithSign(chosen_player_detail.rp_owned) }} / {{ getWithSign(chosen_player_detail.rp_non_owned) }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row no-gutters" v-if="is_using_sample">
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Selected</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.selected }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.selected * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Lineup</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.lineup_by }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.lineup_by * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Bench</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.benched_by }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.benched_by * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row no-gutters" v-if="is_using_sample">
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Captain</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.captained_by }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.captained_by * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Triple Captain</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.tc_by }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.tc_by * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-4" v-cloak>
                            <div class="d-flex flex-column player-info-bar">
                                <div class="player-info-title text-center p-0">Effective Own.</div>
                                <div class="player-info-value text-center p-0">
                                    {{ chosen_player_stats.multiplier_sum }} / {{ chosen_player_stats.total }} = {{ (chosen_player_stats.multiplier_sum * 100 / Math.max(chosen_player_stats.total, 1)).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Refresh</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="playerModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Swap Players</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-black mb-3">Choose player to swap with <span style="color: darkred">{{ chosen_player.web_name }}</span></div>
                <div class="form-group">
                    <select class="form-control" id="transfer_out">
                        <option v-for="i in team_squad" v-if="i[1].element_type == chosen_player.element_type" :value="i[1].player_id">{{ i[1].web_name }}</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" @click="swapPlayers">Submit</button>
            </div>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="lineupModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Change Lineup</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-small">
                <div class="text-black mb-3 text-center" :class="{'text-danger': !is_formation_valid }">Formation: {{ formation[1] }} {{ is_formation_valid ? "" : "-INVALID-" }}</div>
                <div class="row">
                    <div class="col-6">
                        <span class="text-black d-block mb-1 text-center">Lineup</span>
                        <table class="table table-sm table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Name</th>
                                    <th v-if="is_using_captain">Cap</th>
                                    <th v-if="is_using_captain">TC</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template v-for="(ty, id) of el_types">
                                    <tr v-for="i in team_squad" v-if="i[1].lineup && parseInt(i[1].element_type)==id">
                                        <td>{{ ty.short }}</td>
                                        <td>{{ i[1].web_name}} <span class="captain_color" v-if="is_using_captain && i[1].captain">{{ i[1].multiplier == 3 ? "[TC]" : "[C]" }}</span></td>
                                        <td v-if="is_using_captain"><button class="button btn-sm btn-in-modal" :data-id="i[1].player_id" @click="chooseCaptain"><i class="fa fa-star" aria-hidden="true"></i></button></td>
                                        <td v-if="is_using_captain"><button class="button btn-sm btn-in-modal" :data-id="i[1].player_id" @click="chooseTripleCaptain"><i class="fa fa-star" aria-hidden="true"></i></button></td>
                                        <td><button class="button btn-sm btn-in-modal" :data-id="i[1].player_id" @click="toggleLineupType"><i class="fa fa-arrow-right" aria-hidden="true"></i></button></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-6">
                        <span class="text-black d-block mb-1 text-center">Bench</span>
                        <table class="table table-sm table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Name</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template v-for="(ty, id) of el_types">
                                    <tr v-for="i in team_squad" v-if="!i[1].lineup && parseInt(i[1].element_type)==id">
                                        <td>{{ ty.short }}</td>
                                        <td>{{ i[1].web_name}} </td>
                                        <td><button class="button btn-sm btn-in-modal" :data-id="i[1].player_id" @click="toggleLineupType"><i class="fa fa-arrow-left" aria-hidden="true"></i></button></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="transferModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Transfer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- <div class="text-black mb-3 text-center" :class="{'text-danger': !is_formation_valid }">Formation: {{ formation[1] }} {{ is_formation_valid ? "" : "-INVALID-" }}</div> -->
                <div class="row">
                    <div class="col-12 col-lg-6">
                        <span class="text-black d-block mb-1 text-center">Squad</span>
                        <div class="row d-sm-block d-none" style="height: 2.45rem;">

                        </div>
                        <table class="table table-sm table-striped table-hover text-small" id="transfer_squad_table">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Name</th>
                                    <th class="text-right">xP</th>
                                    <th class="text-right">Own%</th>
                                    <th class="text-right">Price</th>
                                    <th class="text-center">Out</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template v-for="(ty, id) of el_types">
                                    <tr v-for="i in team_squad" v-if="parseInt(i[1].element_type)==id" :class="{'marked-out': i[1].player_id == swap_pair.out }">
                                        <td>{{ ty.short }}</td>
                                        <td>{{ i[1].web_name}} </td>
                                        <td class="text-right">{{ parseFloat(i[1].points_md).toFixed(2) }} </td>
                                        <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }} </td>
                                        <td class="text-right">{{ i[1].price }} </td>
                                        <td class="text-center"><button class="button btn-sm btn-in-modal" :data-pos="ty.short" :data-id="i[1].player_id" @click="markForTransferOut"><i class="fa fa-arrow-right" aria-hidden="true"></i></button></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-12 col-lg-6">
                        <span class="text-black d-block mb-1 text-center">All Players</span>
                        <table class="table table-sm table-striped table-hover text-small" id="all_players_table">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Name</th>
                                    <th class="text-right">xP</th>
                                    <th class="text-right">Own%</th>
                                    <th class="text-right">Price</th>
                                    <th class="text-center">In</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="i in all_except_squad" :class="{'marked-in': i[1].player_id == swap_pair.in }">
                                    <td>{{ el_types[i[1].element_type].short }}</td>
                                    <td>{{ i[1].web_name}}</td>
                                    <td class="text-right">{{ parseFloat(i[1].points_md).toFixed(2) }} </td>
                                    <td class="text-right">{{ parseFloat(i[1].ownership).toFixed(1) }} </td>
                                    <td class="text-right">{{ i[1].price }} </td>
                                    <td class="text-center"><button class="button btn-sm btn-in-modal" :data-pos="el_types[i[1].element_type].short" :data-id="i[1].player_id" @click="markForTransferIn"><i class="fa fa-arrow-left" aria-hidden="true"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="customInputModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Values</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="customInputWrapper" class="text-smaller">
                    <!-- text-smaller -->
                    <table id="customInputTable" class="table table-sm table-striped edit-table-size">
                        <thead>
                            <tr>
                                <th class="text-right">ID</th>
                                <th>Name</th>
                                <th class="text-center">Ownership</th>
                                <th class="text-center">xP</th>
                                <th class="text-center">rP</th>
                                <th class="text-right">Expected</th>
                                <th class="text-right">Realized</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="i in edit_table_cache">
                                <td class="text-right text-muted">{{ i.player_id }}</td>
                                <td>{{ i.web_name }}</td>
                                <td>
                                    <div class="input-group input-group-sm input-perc">
                                        <input type="number" class="form-control" v-model="i.ownership" :data-id="i.player_id" @blur="overrideValue($event.target, 'ownership')">
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm input-numeric">
                                        <input type="number" class="form-control" v-model="i.points_md" :data-id="i.player_id" @blur="overrideValue($event.target, 'xp')">
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group input-group-sm input-numeric">
                                        <input :disabled="!rp_ready" type="number" class="form-control" v-model="i.rp" :data-id="i.player_id" @blur="overrideValue($event.target, 'rp')">
                                    </div>
                                </td>
                                <td class="text-right">{{ getWithSign((1-i.ownership/100)*i.points_md) }}/{{ getWithSign((0-i.ownership/100)*i.points_md) }}</td>
                                <td class="text-right">{{ getWithSign((1-i.ownership/100)*i.rp) }}/{{ getWithSign((0-i.ownership/100)*i.rp) }}</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- <div class="p-2 wait-modal" :class="{'d-none': edit_table_ready}">
                        Refreshing the table. Please wait... <br/>
                        <img class="mx-auto d-block" src="static/images/loading.svg">
                    </div> -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" @click="saveEdits" data-dismiss="modal">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    let league_list = JSON.parse( ** league_list | tojson ** );
</script>

"% with scripts=["main", "team_summary"] %" "% include 'footer.html' %" "% endwith %"