"% include 'header.html' %"

<main class="container">
    <div class="row mb-3">
        <div class="col-12">
            <div class="card border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Season Highlights</h5>
                <div class="scenario_detail">
                    A brief look to your entire season stats per player
                </div>
                <div class="card-body text-center p-3" v-cloak>
                    <div class="row no-gutters justify-content-center">
                        <div class="col-lg-4 col-8">
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="Team ID" v-model.lazy="team_id" :disabled="loading">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button" @click="fetch_team_picks" :disabled="loading">Generate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row no-gutters justify-content-center mt-2" v-if="loading" v-cloak>
                        <div class="col-lg-3 col-8">
                            <span class="text-muted text-xs">Loading the data can take a few seconds.</span>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" :style="{ width: completed/gw*100 + '%' }" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Team of the Year</h5>
                <div class="scenario_detail">
                    Your top scoring players of the season
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row">
                        <div class="col-12 col-lg-6" id="top_players_field">
                            <div class="col-12">
                                <div class="text-center">
                                    <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                        <input type="checkbox" class="custom-control-input" id="toty_relative_s" v-model="toty_relative">
                                        <label class="custom-control-label highlighted-checkbox" for="toty_relative_s">Show Relative Gain</label>
                                    </div>
                                </div>
                            </div>

                            <div class="lineup gray-bg">
                                <svg class="mx-auto d-block" viewBox="0 0 112.44791 168.72709" style="max-height: 700px">
                                    <svg class="field">
                                        <g class="g_field">
                                            <rect class="field-common" width="104.4753" height="136.70862" x="4.0935702" y="3.8053379" />
                                            <path class="field-common" d="M 9.7876973,3.8053379 A 5.6941271,5.6941271 0 0 1 4.0935704,9.499465 l -2e-7,-5.6941271 z" />
                                            <path class="field-common" id="right_top_corner" d="m 9.499465,-108.56887 a 5.6941271,5.6941271 0 0 1 -5.6941269,5.69413 l -2e-7,-5.69413 z" transform="rotate(90)" />
                                            <path class="field-common" id="right_bottom_corner" d="m -102.87474,-140.51396 a 5.6941271,5.6941271 0 0 1 -5.69413,5.69413 l 0,-5.69413 z" transform="scale(-1)" />
                                            <path class="field-common" id="left_bottom_corner" d="m -134.81983,4.0935702 a 5.6941271,5.6941271 0 0 1 -5.69413,5.6941271 l 0,-5.6941271 z" transform="rotate(-90)" />
                                            <rect class="field-common" id="top_penalty_box" width="46.726002" height="21.884615" x="32.992699" y="3.852963" />
                                            <rect class="field-common" id="top_inner_box" width="24.50474" height="11.328758" x="44.101284" y="3.828212" />
                                            <path class="field-common" id="top_arch" d="m 65.686854,25.720037 a 9.4620543,6.1092615 0 0 1 -4.731027,5.290776 9.4620543,6.1092615 0 0 1 -9.462054,0 9.4620543,6.1092615 0 0 1 -4.731027,-5.290776 l 9.462054,0 z" />
                                            <path class="field-common" id="bottom_arch" d="m -47.240994,-118.62238 a 9.4620543,6.1092615 0 0 1 -4.731028,5.29077 9.4620543,6.1092615 0 0 1 -9.462054,0 9.4620543,6.1092615 0 0 1 -4.731027,-5.29077 l 9.462054,0 z" transform="scale(-1)" />
                                            <rect class="field-common" id="bottom_penalty_box" width="46.726002" height="21.884615" x="-79.962532" y="-140.46913" transform="scale(-1)" />
                                            <rect class="field-common" id="bottom_inner_box" width="24.50474" height="11.328759" x="-68.851799" y="-140.42613" transform="scale(-1)" />
                                            <circle class="field-common" id="kick_off" cx="55.893227" cy="71.70208" r="14.196868" />
                                            <path class="field-common field-last-path" d="M 4.1010416,71.569791 H 108.51143" id="center_line" inkscape:connector-curvature="0"/>
                                            <rect class="field-common" id="bench_box" width="104.4753" height="24.503908" x="4.0935702" y="140.51396" />
                                        </g>
                                    </svg>
                                <svg v-for="player in toty_final" :x="player.x" :y="player.y">
                                        <g class="g_jersey" :class="{jersey_bench: player.multiplier == 0}" style="transform:translate(-20px,-35px)">
                                            <path  d="m 23.22238,41.75816 5.79975,-3.461141 h 6.010222 l 5.986838,3.484525 -1.520095,3.624845 -2.081363,-0.724969 V 54.784206 H 26.870609 V 44.634647 l -2.221678,0.888672 z" class="jersey-regular"/>
                                            <g >
                                                <path class="jersey-regular" d="m 24.461842,40.986418 1.07576,2.642627"   />
                                                <path class="jersey-regular" d="m 25.186811,40.518696 0.748355,1.91766"  />
                                            </g>
                                            <g transform="matrix(-1,0,0,1,74.133883,-0.39756341)" >
                                                <path class="jersey-regular" d="m 34.435651,41.5351 1.07576,2.642627"   />
                                                <path class="jersey-regular" d="m 35.16062,41.067378 0.748355,1.91766"   />
                                            </g>
                                            <path d="m 29.02213,38.297019 3.042062,3.308712 2.96816,-3.308712" class="jersey-regular" />
                                            <g clip-path="url(#clipPath867)" transform="translate(22.73135,-236.63834)">
                                                <g><text y="285.37598" x="9.281539" class="jersey-regular-text">
                                                        <tspan
                                                            class="jersey-xp-text"
                                                            y="285.37598" x="9.281539"  ><tspan style="font-size:5px" >{{ player.points_total }}</tspan>
                                                        </tspan>
                                                    </text>
                                                    <!-- <text  y="289.78659" x="9.3432751" class="jersey-regular-text jersey-team-text">
                                                        <tspan v-if="true"
                                                            class="jersey-captain-star"
                                                            y="281.28659" x="11.3432751"  >â˜…</tspan>
                                                    </text> -->
                                                    <rect y="291.74704" x="0.028824098" height="3.1975782" width="18.470304" class="jersey-name-bg" />
                                                    <rect y="294.94461" x="0.028824052" height="2.0213056" width="18.470306" class="jersey-team-bg" />
                                                    <text  y="294.1311" x="9.3312988" class="jersey-regular-text"
                                                        xml:space="preserve">
                                                        <tspan
                                                            class="jersey-player-name"
                                                            y="294.1311" x="9.3312988" >{{ player.player.name }}</tspan>
                                                    </text>
                                                    <text y="296.74948" x="9.2921124" class="jersey-regular-text"
                                                        xml:space="preserve">
                                                        <tspan
                                                            class="jersey-team-name"
                                                            y="296.74948" x="9.2921124" >{{ teams_ordered[player.player.raw.team-1].name }}</tspan>
                                                    </text>
                                                    <text class="jersey-cost-text" xml:space="preserve">
                                                        <tspan style="text-align:center" y="289.74948" x="9.2921124" style="font-size:2px; fill: black" v-if="player.cap_count > 0"  >Cap: {{
                                                            player.cap_count }}</tspan>
                                                    </text>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                </svg>
                            </div>

                        </div>
                        <div class="col-12 col-lg-6" id="top_players_list" v-if="ready">
                            <span class="d-block border-below-orange">All squad players and their point returns</span>
                            <table class="p-0 col-12 table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="top_players_table">
                                <thead>
                                    <tr>
                                        <th class="text-muted sticky-col">ID</th>
                                        <th class="sticky-col">Name</th>
                                        <th>Pos</th>
                                        <th>Lineup</th>
                                        <th>Bench</th>
                                        <th>Capt</th>
                                        <th>Points</th>
                                        <th>Gain Pts</th>
                                        <!-- <th>Eff.Points</th> -->
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="p in user_player_sum" class="owned-row">
                                        <td class="text-muted sticky-col">{{ p.id }}</td>
                                        <td class="sticky-col">{{ p.name }}</td>
                                        <td>{{ element_type[p.position].short }}</td>
                                        <td>{{ p.lineup_count }}</td>
                                        <td>{{ p.squad_count - p.lineup_count }}</td>
                                        <td>{{ p.cap_count }}</td>
                                        <td>{{ p.points_total }}</td>
                                        <td>{{ p.points_total_rel }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mt-1 d-flex mx-auto justify-content-center" id="csv_buttons">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Points Analysis per Player</h5>
                <div class="scenario_detail">
                    Impact of each player on your season - realized and predicted
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="text-center text-small mb-1">
                        The prediction values are courtesy of FPLReview Free Model
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-6">
                            <div class="row justify-content-center mb-3">
                                <div class="col-12">
                                    <span class="d-block border-below-orange">Total realized gain / loss per player</span>
                                    <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="total_gain_loss_table" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center">Name</th>
                                                <th class="text-center">Team</th>
                                                <th class="text-center">Pos</th>
                                                <th class="text-center">Pts</th>
                                                <th class="text-center">Gain</th>
                                                <th class="text-center">Loss</th>
                                                <th class="text-center highlighted-text-col">Net</th>
                                                <th class="text-center">Impact</th>
                                            </tr>
                                        </thead>
                                        <tbody v-cloak>
                                            <tr v-for="p in user_ownership_gain_loss.combined_per_player" :class="{'owned-row': p.net>0, 'nonowned-row': p.net < 0}">
                                                <!-- <td class="text-center text-muted">{{ p.id }}</td> -->
                                                <td class="text-center">{{ fpl_element[p.id].web_name }}</td>
                                                <td class="text-center">{{ team_codes[fpl_element[p.id].team_code].short }}</td>
                                                <td class="text-center">{{ element_type[fpl_element[p.id].element_type].short }}</td>
                                                <td class="text-center">{{ p.points }}</td>
                                                <td class="text-center">{{ rounded(p.gain) }}</td>
                                                <td class="text-center">{{ rounded(p.loss) }}</td>
                                                <td class="text-center highlighted-text-col">{{ rounded(p.net) }}</td>
                                                <td class="text-center">{{ rounded(p.impact) }}%</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="row col-8 col-lg-6 justify-content-center" id="csv_buttons4">
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="row justify-content-center mb-3">
                                <div class="col-12">
                                    <span class="d-block border-below-orange">Total predicted gain / loss per player</span>
                                    <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="total_exp_gain_loss_table" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center">Name</th>
                                                <th class="text-center">Team</th>
                                                <th class="text-center">Pos</th>
                                                <th class="text-center">xPts</th>
                                                <th class="text-center">xGain</th>
                                                <th class="text-center">xLoss</th>
                                                <th class="text-center highlighted-text-col">xNet</th>
                                                <th class="text-center">xImpact</th>
                                            </tr>
                                        </thead>
                                        <tbody v-cloak>
                                            <tr v-for="p in user_ownership_gain_loss.combined_per_player_exp" :class="{'owned-row': p.xnet>0, 'nonowned-row': p.xnet < 0}">
                                                <!-- <td class="text-center text-muted">{{ p.id }}</td> -->
                                                <td class="text-center">{{ fpl_element[p.id].web_name }}</td>
                                                <td class="text-center">{{ team_codes[fpl_element[p.id].team_code].short }}</td>
                                                <td class="text-center">{{ element_type[fpl_element[p.id].element_type].short }}</td>
                                                <td class="text-center">{{ rounded(p.xpoints) }}</td>
                                                <td class="text-center">{{ rounded(p.xgain) }}</td>
                                                <td class="text-center">{{ rounded(p.xloss) }}</td>
                                                <td class="text-center highlighted-text-col">{{ rounded(p.xnet) }}</td>
                                                <td class="text-center">{{ rounded(p.ximpact) }}%</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="row col-8 col-lg-6 justify-content-center" id="csv_buttons_exp">
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="row justify-content-center mb-3">
                                <div class="col-12">
                                    <span class="d-block border-below-orange">Total luck per player</span>
                                    <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="total_player_luck_table" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center">Name</th>
                                                <th class="text-center">Team</th>
                                                <th class="text-center">Pos</th>
                                                <th class="text-center">Net</th>
                                                <th class="text-center">xNet</th>
                                                <th class="text-center highlighted-text-col">Luck</th>
                                                <th class="text-center">Impact</th>
                                            </tr>
                                        </thead>
                                        <tbody v-cloak>
                                            <tr v-for="p in user_ownership_gain_loss.comb_per_player_luck" :class="{'owned-row': p.luck>0, 'nonowned-row': p.luck < 0}">
                                                <!-- <td class="text-center text-muted">{{ p.id }}</td> -->
                                                <td class="text-center">{{ fpl_element[p.id].web_name }}</td>
                                                <td class="text-center">{{ team_codes[fpl_element[p.id].team_code].short }}</td>
                                                <td class="text-center">{{ element_type[fpl_element[p.id].element_type].short }}</td>
                                                <td class="text-center">{{ rounded(p.net) }}</td>
                                                <td class="text-center">{{ rounded(p.xnet) }}</td>
                                                <td class="text-center highlighted-text-col">{{ getWithSign(p.luck) }}</td>
                                                <td class="text-center">{{ rounded(p.luckimpact) }}%</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <!-- <th class="text-center text-muted">ID</th> -->
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                                <th class="text-center"></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="row col-8 col-lg-6 justify-content-center" id="csv_buttons_luck_table">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


    



    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Point Distribution</h5>
                <div class="scenario_detail">
                    Distribution of your points from each type
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-2">
                            <span class="d-block border-below-orange">Total counts of key events per GW</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="gw_points_table" v-if="ready">
                                <thead>
                                    <tr>
                                        <th>GW</th>
                                        <th class="text-center">Clean Sheet</th>
                                        <th class="text-center">Goal</th>
                                        <th class="text-center">Assist</th>
                                        <th class="text-center">Bonus</th>
                                        <th class="text-center">Hits</th>
                                        <th class="text-center">Points</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="p in user_stats_per_gw.points" class="owned-row">
                                        <td class="text-center">{{ p.gw }}</td>
                                        <td :data-order=" p.info.type_sums['clean_sheets'] || 0">
                                            <span class="gw_detail_number">{{ p.info.type_sums['clean_sheets'] || 0 }}</span>
                                            <span class="gw_detail_players">{{ p.info.type_names['clean_sheets'] || '' }}</span>
                                        </td>
                                        <td :data-order="p.info.type_sums['goals_scored'] || 0">
                                            <span class="gw_detail_number">{{ p.info.type_sums['goals_scored'] || 0 }}</span>
                                            <span class="gw_detail_players">{{ p.info.type_names['goals_scored'] || '' }}</span>
                                        </td>
                                        <td :data-order="p.info.type_sums['assists'] || 0">
                                            <span class="gw_detail_number">{{ p.info.type_sums['assists'] || 0 }}</span>
                                            <span class="gw_detail_players">{{ p.info.type_names['assists'] || '' }}</span>
                                        </td>
                                        <td :data-order="p.info.type_sums['bonus'] || 0">
                                            <span class="gw_detail_number">{{ p.info.type_sums['bonus'] || 0 }}</span>
                                            <span class="gw_detail_players">{{ p.info.type_names['bonus'] || '' }}</span>
                                        </td>
                                        <td>
                                            <span class="gw_detail_number">{{ p.hit_pts/4 }}</span>
                                        </td>
                                        <td>
                                            <span class="gw_detail_number">{{ p.net_pts }}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <span class="d-block border-below-orange">Point distribution per event type</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="type_points_table" v-if="ready">
                                <thead>
                                    <tr>
                                        <th class="text-center">Type</th>
                                        <th class="text-center">Count</th>
                                        <th class="text-center">Total</th>
                                        <th class="text-center">Per Player</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">Percentage</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="(value, key) in user_stats_per_gw.type_grouped" class="owned-row">
                                        <td class="text-center">{{ player_stat_types[key].name }}</td>
                                        <td class="text-center">{{ player_stat_types[key].pp ? value.length : "-" }}</td>
                                        <td class="text-center">{{ getSum(value.map(i => parseInt(i.value))) }}</td>
                                        <td class="text-center">
                                            {{ player_stat_types[key].pp ? rounded(getSum(value.map(i => parseInt(i.value))) / user_stats_per_gw.total_picks,2) : "-" }}
                                        </td>
                                        <td class="text-center">
                                            {{ getSum(value.map( i=> parseInt(i.points * i.multiplier))) }}
                                        </td>
                                        <td class="text-center">
                                            {{ rounded(getSum(value.map( i=> parseInt(i.points * i.multiplier))) / user_stats_per_gw.overall_total * 100, 1)  }}%
                                        </td>
                                    </tr>
                                    <tr class="bench-row">
                                        <td class="text-center"><b>Hits</b></td>
                                        <td class="text-center">{{ user_stats_per_gw.points.filter(i => i.hit_pts > 0).length }}</td>
                                        <td class="text-center">{{ getSum(user_stats_per_gw.points.map(i => i.hit_pts))/4 }}</td>
                                        <td></td>
                                        <td class="text-center">{{ -getSum(user_stats_per_gw.points.map(i => i.hit_pts)) }}</td>
                                        <td class="text-center">{{ rounded(-getSum(user_stats_per_gw.points.map(i => i.hit_pts)) / user_stats_per_gw.overall_total * 100, 1)  }}%</td>
                                    </tr>
                                    <tr class="nonowned-row">
                                        <td class="text-center"><b>Total</b></td>
                                        <td class="text-center"></td>
                                        <td class="text-center"></td>
                                        <td class="text-center"></td>
                                        <td class="text-center">{{ user_stats_per_gw.overall_total }}</td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="mt-1 d-flex mx-auto justify-content-center" id="csv_buttons2">
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 mb-2">
                            <span class="d-block border-below-orange">Detailed points returns per event type and GW</span>
                            <div id="event_heatmap">

                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Target Event Ratios</h5>
                <div class="scenario_detail">
                    Success ratio on defense/attack picks
                </div>
                <div class="card-body" v-if="ready" v-cloak>

                    <div class="row justify-content-center mb-2">
                        <div class="col-12 col-lg-8">
                            <table class="col-12 table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="key_events_ratio_table">
                                <thead>
                                    <tr>
                                        <th class="text-center">Target</th>
                                        <th class="text-center">Success</th>
                                        <th class="text-center">Picks</th>
                                        <th class="text-center highlighted-col">Success Ratio</th>
                                        <th class="text-center">Info</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="(v, key) in user_picks_custom_stats" class="owned-row">
                                        <td class="text-center">{{ key }}</td>
                                        <td class="text-center">{{ v.count }}</td>
                                        <td class="text-center">{{ v.total }}</td>
                                        <td class="text-center highlighted-col">{{ rounded(v.count / v.total * 100, 2) }}%</td>
                                        <td class="text-center">{{ v.info }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8 row justify-content-center">
                            <div id="manager_comparison" class="col-12">
                                
                            </div>
                            <div class="col-10 col-lg-8">
                                <span class="text-small">Enter a team ID to compare</span>
                                <div class="input-group mb-3">
                                    <input type="number" class="form-control" placeholder="Team ID" id="new_id">
                                    <div class="input-group-append">
                                      <button class="btn btn-secondary" type="button" @click="add_ID_to_compare">Compare</button>
                                    </div>
                                    <div class="input-group-append">
                                        <button class="btn btn-danger" type="button" @click="clear_rivals">Clear</button>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8">
                            <span class="d-block border-below-orange">Success and returns out of key stats</span>
                            <table class="col-12 table table-sm text-white text-small m-data-table mt-1 mb-1 custom-table-responsive p-0" id="all_picks_per_stat">
                                <thead>
                                    <tr>
                                        <th class="text-center text-muted text-xs">GID</th>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Pos</th>
                                        <th class="text-center">Stat</th>
                                        <th class="text-center">Pts</th>
                                        <th class="text-center">Success</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <template v-for="(v, key) in user_picks_custom_stats" v-if="v.hasOwnProperty('values')">
                                        <tr :class="{'owned-row': p.success, 'nonowned-row': !p.success}" v-for="p in v.values">
                                            <td class="text-center text-muted text-xs">{{ p.fixture }}</td>
                                            <td class="text-center">{{ p.gw }}</td>
                                            <td class="text-center">{{ p.name }}</td>
                                            <td class="text-center">{{ element_type[p.eltype].short }}</td>
                                            <td class="text-center">{{ key }}</td>
                                            <td class="text-center">{{ p.returns }}</td>
                                            <td class="text-center">{{ p.success ? "True" : "False"}}</td>
                                        </tr>
                                    </template>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th class="text-center text-muted text-xs">GID</th>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Pos</th>
                                        <th class="text-center">Stat</th>
                                        <th class="text-center">Pts</th>
                                        <th class="text-center">Success</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="row col-8 col-lg-6 justify-content-center" id="csv_buttons3">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Timings of ownership</h5>
                <div class="scenario_detail">
                    Time periods of owning your key players
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row">
                        <div class="col-12">
                            <div id="add_chart_button_group" class="justify-content-center row">

                                <div class="col-8 col-lg-6 input-group mb-3">
                                    <select class="custom-select" id="new_player_id">
                                        <option v-for="p in user_player_sum" :value="p.id">{{ p.name }} ({{ p.points_total }})</option>
                                    </select>
                                    <div class="input-group-append">
                                        <button class="btn btn-secondary" type="button" @click="add_player_plot">Plot</button>
                                    </div>
                                </div>

                            </div>
                            <div class="text-center">
                                <span class="svg-legend-text mr-2"><svg width="20" height="20"><g>
                                    <rect x="0" y="0" width="20" height="20" fill="#6fcfd6" opacity="0.3"></rect></g>
                                </svg> Lineup</span>
                                <span class="svg-legend-text"><svg width="20" height="20"><g>
                                    <rect x="0" y="0" width="20" height="20" fill="#b995d2" opacity="0.3"></rect></g>
                                </svg> Bench</span>
                            </div>
                            <div id="player_charts">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Ownership / Differential Analysis</h5>
                <div class="scenario_detail">
                    Gains and losses from key players
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-1">
                        <div class="col-12 col-lg-4">
                            <div class="form-group">
                                <label>Sample tier</label>
                                <div class="input-group">
                                    <select class="custom-select" id="sample_selection" v-model="sample_selection">
                                        <option v-for="(p, index) in sample_options" :value="index">{{ (p != 'Overall' && p != 'Prime') ? 'Top ' : ''}}{{ p }}</option>
                                    </select>
                                    <div class="input-group-append">
                                        <button class="btn btn-secondary" type="button" @click="invalidate_cache(); redraw_graphs();">Select</button>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <!-- <div class="row justify-content-center mb-3">
                        <div class="col-12 col-lg-4">
                            <span class="text-small">-OR- Enter a team ID to compare</span>
                            <div class="input-group mb-3">
                                <input type="number" class="form-control" placeholder="Team ID" id="new_id_2">
                                <div class="input-group-append">
                                    <button class="btn btn-secondary" type="button" @click="add_ID_to_compare">Compare</button>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <div class="row justify-content-center mb-3">
                        <div class="col-12">
                            <div class="text-center">
                                <span class="svg-legend-text mr-2"><svg width="20" height="20"><g>
                                    <rect x="0" y="0" width="20" height="20" fill="#6fcfd6" opacity="0.9"></rect></g>
                                </svg> Gain</span>
                                <span class="svg-legend-text"><svg width="20" height="20"><g>
                                    <rect x="0" y="0" width="20" height="20" fill="#de6363" opacity="0.9"></rect></g>
                                </svg> Loss</span>
                            </div>
                            <div class="text-center">
                                <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                    <input type="checkbox" class="custom-control-input" id="cumulative_switch" checked @change="refresh_y_axis()">
                                    <label class="custom-control-label highlighted-checkbox" for="cumulative_switch">Cumulative</label>
                                </div>
                                <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                    <input type="checkbox" class="custom-control-input" id="net_switch" @change="refresh_y_axis()">
                                    <label class="custom-control-label highlighted-checkbox" for="net_switch">Net Change</label>
                                </div>
                            </div>
                            <div id="benefit-candlestick-chart">
                                
                            </div>
                            <div class="row flex-grow-1 no-gutters text-small mb-1 pt-1 pb-1">
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                GW
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="hover_gw">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                GW Gain
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="hover_gw_gain">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                GW Loss
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="hover_gw_loss">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-lg-3 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Top Gains
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="hover_top_gains">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-lg-3 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Top Losses
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="hover_top_losses">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-lg-8">
                            <span class="d-block border-below-orange">Gain Analysis</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="gain_table">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">Mult</th>
                                        <th class="text-center">EO%</th>
                                        <th class="text-center">Net Effect</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr class="owned-row" v-for="pair in user_ownership_gain_loss.gains">
                                        <td class="text-center">{{ pair.gw }}</td>
                                        <td class="text-center">{{ fpl_element[pair.id].web_name }}</td>
                                        <td class="text-center">{{ pair.pts }}</td>
                                        <td class="text-center">{{ pair.multiplier }}</td>
                                        <td class="text-center">{{ pair.eo }}%</td>
                                        <td class="text-center">{{ rounded(pair.net,2) }}</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">Mult</th>
                                        <th class="text-center">EO%</th>
                                        <th class="text-center">Net Effect</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-12 col-lg-8">
                            <span class="text-smaller">This table shows your lineup picks, their corresponding points per week and your relative gain. Gain is equal to points multiplied with your ownership rate (Multiplier * 100 - EO), which shows you the relative gain compared to field average.</span>
                        </div>
                    </div>

                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-lg-8">
                            <span class="d-block border-below-orange">Loss Analysis (Key Players)</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="loss_table">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">EO%</th>
                                        <th class="text-center">Net Effect</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr class="owned-row" v-for="pair in user_ownership_gain_loss.losses">
                                        <td class="text-center">{{ pair.gw }}</td>
                                        <td class="text-center">{{ fpl_element[pair.id].web_name }}</td>
                                        <td class="text-center">{{ pair.pts }}</td>
                                        <td class="text-center">{{ pair.eo }}%</td>
                                        <td class="text-center">{{ rounded(pair.net,2) }}</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Player</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">EO%</th>
                                        <th class="text-center">Net Effect</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-12 col-lg-8">
                            <span class="text-smaller">This table shows players you haven't picked, their corresponding points per week and your relative loss. Loss is equal to points multiplied with effective ownership rate (EO), which shows you the relative loss compared to field average.</span>
                        </div>
                    </div>

                    <div class="row justify-content-center mb-1">
                        <div class="col-12 col-lg-8">
                            <span class="d-block border-below-orange">Risk Analysis</span>
                        </div>
                    </div>

                    <div class="row justify-content-center mb-1">
                        <div class="col-12 col-lg-4">
                            <div class="form-group">
                                <label>Sample tier</label>
                                <select class="custom-select" id="sample_selection-2" v-model="sample_selection" @change="invalidate_cache(); redraw_graphs();">
                                    <option v-for="(p, index) in sample_options" :value="index">{{ p != 'Overall' ? 'Top ' : ''}}{{ p }}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row justify-content-center mb-3">
                        <div class="col-12">
                            <div id="gw-risk-chart">

                            </div>
                            <div class="row flex-grow-1 no-gutters text-small mb-1 pt-1 pb-1">
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                GW
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="risk_hover_gw">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Differential Rate <!-- Total your ownership divided by 1200% -->
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="risk_hover_diff_rate">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 col-lg-2 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Change <!-- Gain minus loss -->
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="risk_hover_reward">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-lg-3 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Top Bets For
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="risk_top_bets_for">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-lg-3 mb-1" v-cloak>
                                    <div class="d-flex flex-column metric">
                                        <div class="text-center p-0">
                                            <div class="legend-box text-center">
                                                Top Bets Against
                                            </div>
                                        </div> 
                                        <div class="setting-value text-center p-0 d-flex flex-row justify-content-center">
                                            <span class="setting-value-text" id="risk_top_bets_against">
                                                
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-8">
                            <span class="text-smaller">This scatter plot shows your relative change to average and your differential (risk) percentage. This value is calculated based on how different your lineup compared to tier effective ownership. It is a measure of how much you are betting against the template.</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Predicted / Realized Performance</h5>
                <div class="scenario_detail">
                    Decision making quality compared to actual outcome
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12">
                            <div class="text-center">
                                <span class="svg-legend-text mr-2">
                                    <svg width="20" height="10"><g><line id="svg_1" y2="5" x2="20" y1="5" x1="0" stroke-width="1.5" stroke="#dbf7b4" stroke-dasharray="4,1" fill="none"></line></g></svg> Predicted
                                </span>
                                <span class="svg-legend-text mr-2">
                                    <svg width="20" height="10"><g><line id="svg_1" y2="5" x2="20" y1="5" x1="0" stroke-width="1.5" stroke="#6fcfd6" fill="none"></line></g></svg> Realized
                                </span>
                            </div>

                            <div id="season-xp-real-diff-plot">
                                
                            </div>

                        </div>
                        <div class="col-12 col-lg-8 mb-3 text-small">
                            <span class="text-smaller d-block">
                                In the tables below, it is assumed that the FPLReview predicted values are true expectations.
                                Therefore, any outcome up to the predictions is measured as "skill" and remaining difference (above or below) is measured as "luck" even though this might not be actually true.
                                The aim here is to evaluate decision making quality, and see how much unpredicted outcomes have affected your season, either good or bad.
                            </span>
                            <span class="text-smaller d-block">
                                "Diff" refers to point difference between you and the tier average you have selected.
                                Even if GW ends up with more or less points than predicted, we expect difference to be around the pre-GW prediction.
                            </span>
                        </div>
                        <div class="col-12">
                            <div class="text-center">
                                <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                    <input type="checkbox" class="custom-control-input" id="all_gw_switch" v-model="show_all_season">
                                    <label class="custom-control-label highlighted-checkbox" for="all_gw_switch">Show All GWs</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="text-center text-small">GW-by-GW values</div>
                            <table class="table table-sm text-white text-small mt-1 mb-1 custom-table-responsive p-0 narrow-td no-row-borders" 
                                id="gw_history">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Pred. Pts</th>
                                        <th class="text-center">Real. Pts</th>
                                        <th class="text-center">Pred. Diff</th>
                                        <th class="text-center">Real. Diff</th>
                                        <th class="text-center">GW Luck</th>
                                        <th class="text-center">GW Rank</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr :class="{'owned-row': v.luck > 0, 'nonowned-row': v.luck < 0}" v-for="(v, key) in user_gw_results.data" 
                                        v-if="show_all_season || (key == user_gw_results.finish)">
                                        <td class="text-center">{{ v.gw }}</td>
                                        <td class="text-center">{{ rounded(v.xp) }}</td>
                                        <td class="text-center">{{        (v.rp) }}</td>
                                        <td class="text-center">{{ rounded(v.exp_diff) }}</td>
                                        <td class="text-center">{{ rounded(v.real_diff) }}</td>
                                        <td class="text-center">{{ rounded(v.luck) }}</td>
                                        <td class="text-center">{{ team_data[v.gw].entry_history.rank }}</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr v-if="show_all_season">
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Pred. Pts</th>
                                        <th class="text-center">Real. Pts</th>
                                        <th class="text-center">Pred. Diff</th>
                                        <th class="text-center">Real. Diff</th>
                                        <th class="text-center">GW Luck</th>
                                        <th class="text-center">GW Rank</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="text-center text-small">Total values</div>
                            <table class="table table-sm text-white text-small mt-1 mb-1 custom-table-responsive p-0 narrow-td no-row-borders" 
                                id="gw_history_total">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Pred. Pts</th>
                                        <th class="text-center">Real. Pts</th>
                                        <th class="text-center">Pred. Diff</th>
                                        <th class="text-center">Real. Diff</th>
                                        <th class="text-center">Luck</th>
                                        <th class="text-center">OR</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr :class="{'owned-row': v.luck > 0, 'nonowned-row': v.luck < 0}" v-for="(v, key) in user_gw_results.data"
                                        v-if="show_all_season || (key == user_gw_results.finish)">
                                        <td class="text-center">{{ v.gw }}</td>
                                        <td class="text-center">{{ rounded(v.total_xp) }}</td>
                                        <td class="text-center">{{        (v.total_rp) }}</td>
                                        <td class="text-center">{{ rounded(v.total_exp_diff) }}</td>
                                        <td class="text-center">{{ rounded(v.total_real_diff) }}</td>
                                        <td class="text-center">
                                            <span v-if="v.luck > 0"><i class="fas fa-caret-up" style="color: rgb(0, 217, 0);"></i> </span>
                                            <span v-if="v.luck < 0"><i class="fas fa-caret-down" style="color: rgb(255, 0, 90);"></i> </span>
                                            {{ rounded(v.total_exp_real_diff) }}
                                        </td>
                                        <td class="text-center">
                                            <span v-if="v.gw > 1 && team_data[v.gw].entry_history.overall_rank < team_data[parseInt(v.gw)-1].entry_history.overall_rank"><i class="fas fa-caret-up" style="color: rgb(0, 217, 0);"></i> </span>
                                            <span v-else-if="v.gw > 1"><i class="fas fa-caret-down" style="color: rgb(255, 0, 90);"></i> </span>
                                            {{ team_data[v.gw].entry_history.overall_rank }}
                                        </td>                                    
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr v-if="show_all_season">
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Pred. Pts</th>
                                        <th class="text-center">Real. Pts</th>
                                        <th class="text-center">Pred. Diff</th>
                                        <th class="text-center">Real. Diff</th>
                                        <th class="text-center">Luck</th>
                                        <th class="text-center">OR</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="text-center text-small">Skill/Luck Magnitude Proportion</div>
                            <table class="table table-sm text-white text-small mt-1 mb-1 custom-table-responsive p-0 narrow-td no-row-borders" 
                                id="gw_history_skill">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">GW Skill</th>
                                        <th class="text-center">GW Luck</th>
                                        <th class="text-center">Total Skill</th>
                                        <th class="text-center">Total Luck</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr :class="{'owned-row': v.luck > 0, 'nonowned-row': v.luck < 0}" v-for="(v, key) in user_gw_results.data"
                                        v-if="show_all_season || (key == user_gw_results.finish)">
                                        <td class="text-center">{{ v.gw }}</td>
                                        <td class="text-center"><span v-if="v.skill_ratio<0">(-) </span>{{ Math.abs(v.skill_ratio) }}%</td>
                                        <td class="text-center"><span v-if="v.luck_ratio<0">(-) </span>{{ Math.abs(v.luck_ratio) }}%</td>
                                        <td class="text-center"><span v-if="v.total_skill_ratio<0">(-) </span>{{ Math.abs(v.total_skill_ratio) }}%</td>
                                        <td class="text-center"><span v-if="v.total_luck_ratio<0">(-) </span>{{ Math.abs(v.total_luck_ratio) }}%</td>
                                        
                                </tbody>
                                <tfoot>
                                    <tr v-if="show_all_season">
                                        <th class="text-center">GW</th>
                                        <th class="text-center">GW Skill</th>
                                        <th class="text-center">GW Luck</th>
                                        <th class="text-center">Total Skill</th>
                                        <th class="text-center">Total Luck</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 mt-2" v-if="season_targets && sample_selection==6 && final_outcome != undefined">
                            <div class="col-12">
                                <span class="d-block border-below-orange">What-if Luck-Meter</span>
                            </div>
                            <div class="text-center text-small">
                                You have finished season with {{ _.round(final_outcome.total_real_diff,1) }} relative points compared  Prime Sample. To get OR #1 you needed {{ season_targets[0][2] }}.<br/>
                                Move the Luck Slider below to see where you could have ended!<br/>
                                It shows the magnitude weight of luck (variance) compared to sum of skill (predicted) and luck (variance) and calculates your final difference to tier average.
                            </div>
                            <div class="mt-3 mb-1 text-center">
                                <div class="m-2">
                                    <input type="range" class="col-12 col-md-6 form-range p-0" min="-99.9" max="99.9" step="0.1" v-model.number="luck_input" >
                                    <span class="d-block" >{{ _.round(luck_input,1) }}%</span>
                                </div>
                            </div>
                            <div class="row justify-content-center mb-3">
                                <div class="col-6 row justify-content-center">
                                    <div class="col text-center">
                                        <div class="xp-bg text-black">Skill</div><div>{{ _.round(final_outcome.total_exp_diff,1) }}</div>
                                    </div>
                                    <div class="col-1 text-center">
                                        <div class="">+</div><div>&nbsp;</div>
                                    </div>
                                    <div class="col text-center">
                                        <div class="rp-bg text-black">Luck</div><div>{{ _.round(calculated_luck,1) }}</div>
                                    </div>
                                    <div class="col-1 text-center">
                                        <div class="">=</div><div>&nbsp;</div>
                                    </div>
                                    <div class="col text-center">
                                        <div class="outcome-bg text-black">Total</div><div>{{ _.round(calculated_total,1) }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content-center mb-3">
                                <div class="col-6 d-flex flex-column">
                                    <div class="text-center text-small">With this result, you would finish in OR</div>
                                    <div class="text-center">{{ potential_result }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Transfer Quality Analysis</h5>
                <div class="scenario_detail">
                    A review of transfers with hindsight/foresight analysis
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12">
                            <!-- <div class="text-center">
                                <span class="svg-legend-text mr-2">
                                    <svg width="20" height="10"><g><line id="svg_1" y2="5" x2="20" y1="5" x1="0" stroke-width="1.5" stroke="#dbf7b4" stroke-dasharray="4,1" fill="none"></line></g></svg> Predicted
                                </span>
                                <span class="svg-legend-text mr-2">
                                    <svg width="20" height="10"><g><line id="svg_1" y2="5" x2="20" y1="5" x1="0" stroke-width="1.5" stroke="#6fcfd6" fill="none"></line></g></svg> Realized
                                </span>
                            </div> -->

                            <div id="transfer-quality-plot">
                                
                            </div>

                        </div>
                        
                        <div class="col-12 col-md-9">
                            <div class="text-center text-smaller">Comparison of predicted/realized points in following 5 GWs (excluding hits)</div>
                            <div v-if="transfer_analysis" class="row mt-1 mb-2">
                                <div class="col-4 text-center text-small">Hindsight Optimal Ratio <br><span class="rp-color">{{ transfer_analysis.hs_ratio }}</span></div>
                                <div class="col-4 text-center text-small">Foresight Optimal Ratio <br><span class="xp-color">{{ transfer_analysis.fs_ratio }}</span></div>
                                <div class="col-4 text-center text-small">Avg. Transfer xP Optimality <br><span class="outcome-color">{{ rounded(transfer_analysis.tr_optimality,1) }}%</span></div>
                            </div>
                            <div class="text-center">
                                <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                    <input type="checkbox" class="custom-control-input" id="show_all_transfers" v-model="show_all_transfers">
                                    <label class="custom-control-label highlighted-checkbox" for="show_all_transfers">Show All Transfers</label>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-sm text-white text-small mt-1 mb-1 custom-table-responsive p-0 narrow-td table-striped" 
                                    id="transfer_quality">
                                    <thead>
                                        <tr>
                                            <th class="text-center">GW</th>
                                            <th class="text-center">Range</th>
                                            <th class="text-center">Sold</th>
                                            <th class="text-center">Bought</th>
                                            <th class="text-center">rP Diff</th>
                                            <th class="text-center">xP Diff</th>
                                            <th class="text-center">Hindsight Optimal</th>
                                            <th class="text-center">Foresight Optimal</th>
                                            <th class="text-center">xP Optimality</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="entry in Object.values(transfer_analysis.gws).flat()" v-if="show_all_transfers || (entry.best_xp_tr || entry.best_rp_tr) || (entry.hs_optimal && entry.fs_optimal)">
                                            <td class="text-center">{{ entry.gw }}</td>
                                            <td class="text-center">{{ entry.gw_list }}</td>
                                            <td class="text-center">{{ fpl_element[entry.sold].web_name }}</td>
                                            <td class="text-center">
                                                <div>{{ fpl_element[entry.bought].web_name }}</div>
                                                <div v-if="entry.best_xp" class="xp-color text-smaller">{{ entry.bought == entry.best_xp.id ? "FS Optimal" : "" }}</div>
                                                <div v-if="entry.best_rp" class="rp-color text-smaller">{{ entry.bought == entry.best_rp.id ? "HS Optimal" : "" }}</div>
                                            </td>
                                            <td class="text-center rp-color">{{ getWithSign(entry.rp_diff,0) }}</td>
                                            <td class="text-center xp-color">{{ getWithSign(entry.xp_diff,1) }}</td>
                                            <td class="text-center">
                                                <div v-if="entry.best_rp">{{ entry.best_rp.web_name }}</div>
                                                <div v-if="entry.best_rp"><b>rp Diff: <span class="rp-color">{{ getWithSign(entry.best_rp.rp_diff, 0) }}</span></b></div>
                                                <div v-if="entry.best_rp">xP Diff: {{ getWithSign(entry.best_rp.xp_diff) }}</div>
                                            </td>
                                            <td class="text-center">
                                                <div v-if="entry.best_xp">{{ entry.best_xp.web_name }}</div>
                                                <div v-if="entry.best_xp">rp Diff: {{ getWithSign(entry.best_xp.rp_diff) }}</div>
                                                <div v-if="entry.best_xp"><b>xP Diff: <span class="xp-color">{{ getWithSign(entry.best_xp.xp_diff, 1) }}</span></b></div>
                                            </td>
                                            <td class="text-center">{{ entry.xp_ratio }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>



    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Fixture Difficulty Analysis</h5>
                <div class="scenario_detail">
                    Fixture difficulty ratings of your picks through season using FiveThirtyEight data
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 mb-1">
                            <span class="d-block border-below-orange">Defense Difficulty</span>
                            <div class="overflow-auto">
                                <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" style="width: 100%">
                                    <tr>
                                        <th v-for="team in team_fdr_values">{{ team.short }}</th>
                                    </tr>
                                    <tr>
                                        <td v-for="team in team_fdr_values" :style="{backgroundColor: team.offense_color}">
                                            {{ rounded(team.offense_ratio*100,0) }}%
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="col-12">
                            <span class="d-block border-below-orange">Offense Difficulty</span>
                            <div class="overflow-auto">
                                <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" style="width: 100%">
                                    <tr>
                                        <th v-for="team in team_fdr_values">{{ team.short }}</th>
                                    </tr>
                                    <tr>
                                        <td v-for="team in team_fdr_values" :style="{backgroundColor: team.defense_color}">
                                            {{ rounded(team.defense_ratio*100,0) }}%
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12">
                            <span class="d-block border-below-orange">Fixture Difficulty per Player Pick</span>
                        </div>
                        <div class="col-12 col-lg-8">
                            
                            <!-- <span class="d-block border-below-orange">Total gain / loss per player</span> -->
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" id="all_fdr_table" style="width: 100%">
                                <thead>
                                    <tr>
                                        <th class="text-center">GW</th>
                                        <th class="text-center">Name</th>
                                        <th class="text-center">Pos</th>
                                        <th class="text-center">Team</th>
                                        <th class="text-center">Opp</th>
                                        <th class="text-center">Diff. Ratio</th>
                                        <th class="text-center">Points</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="p in user_fdr_values">
                                        <td class="text-center">{{ p.gw }}</td>
                                        <td class="text-center">{{ fpl_element[p.id].web_name }}</td>
                                        <td class="text-center">{{ p.position }}</td>
                                        <td class="text-center">{{ p.self_team.short }}</td>
                                        <td class="text-center">{{ p.opp_team.short }}</td>
                                        <td class="text-center">{{ rounded(p.player_fdr_ratio*100,1) }}%</td>
                                        <td class="text-center">{{ p.total }}</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                        <th class="text-center"></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="row col-8 col-lg-6 justify-content-center mb-3" id="csv_buttons5">
                        </div>
                        
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-6">
                            <span class="d-block border-below-orange">Distribution of Selection per FDR Tier</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive better_pages" style="width: 100%">
                                <tr>
                                    <th>Tier</th>
                                    <th class="text-center">GK</th>
                                    <th class="text-center">DF</th>
                                    <th class="text-center">MD</th>
                                    <th class="text-center">FW</th>
                                    <th class="text-center">Total</th>
                                </tr>
                                <tr v-for="(g,i) in user_fdr_tiers.groups">
                                    <th scope="row">{{ (g-.25)*100 }}-{{ g*100 }}%</th>
                                    <td class="text-center" v-for="p in [1,2,3,4]">{{ user_fdr_tiers.tiers[p][i] }}</td>
                                    <td class="text-center">{{ getSum([1,2,3,4].map(j => user_fdr_tiers.tiers[j][i])) }}</td>
                                </tr>
                                <!-- <tr>
                                    <td v-for="team in team_fdr_values" :style="{backgroundColor: team.defense_color}">
                                        {{ rounded(team.defense_ratio*100,0) }}%
                                    </td>
                                </tr> -->
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Position / Price Category Analysis</h5>
                <div class="scenario_detail">
                    Total points per position and price category
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-lg-8">
                            <div id="type_heatmap">
                                
                            </div>
                        </div>
                        <div class="text-xs text-center">
                            Price categories (Budget, Mid-Price, Premieum) are as follows: GK Below 5, 5-5.5, Above 5.5 - DF Below 5, 5-6, Above 6 - MD Below 7.5, 7.5-10, Above 10 - FW Below 7.5, 7.5-10, Above 10
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-log-8">
                            <span class="d-block border-below-orange">Point Distribution Treemap (Gain)</span>
                            <div class="text-center">
                                <div class="custom-control custom-switch text-small d-inline-block mr-3">
                                    <input type="checkbox" class="custom-control-input" id="actual_gain_switch" @change="refresh_point_dist()">
                                    <label class="custom-control-label highlighted-checkbox" for="actual_gain_switch">Gain (Effective Points)</label>
                                </div>
                            </div>
                            <div id="points_tree_map">

                            </div>
                        </div>
                        <div class="text-xs text-center">
                            Gain is equal to points multiplied with your ownership rate (Multiplier * 100 - EO), which shows you the relative gain compared to field average.
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-log-8">
                            <span class="d-block border-below-orange">Point Distribution Treemap (Effective Loss)</span>
                            <div id="points_tree_map_loss">

                            </div>
                        </div>
                        <div class="text-xs text-center">
                            Loss is equal to points against multiplied with effective ownership rate, which shows you the relative loss compared to field average.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Formation Analysis</h5>
                <div class="scenario_detail">
                    Chosen formations and returns
                </div>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <div class="col-12 col-lg-8">
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="formation_analysis_table" v-if="ready">
                                <thead>
                                    <tr>
                                        <th class="text-center">Position</th>
                                        <th class="text-center">Picked (GW)</th>
                                        <th class="text-center">Games</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">Points per pick (GW)</th>
                                        <th class="text-center">Points per game</th>
                                        <th class="text-center">Average pick</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="(value, key) in user_formation_analysis_by_eltype" class="owned-row">
                                        <td class="text-center">{{ element_type[key].name }}</td>
                                        <td class="text-center">{{ value.picked }}</td>
                                        <td class="text-center">{{ value.games }}</td>
                                        <td class="text-center">{{ value.points }}</td>
                                        <td class="text-center">{{ rounded(value.ppp,2) }}</td>
                                        <td class="text-center">{{ rounded(value.ppg,2) }}</td>
                                        <td class="text-center">{{ rounded(value.avg_pick,2) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="text-center avg-formation">Average Formation: 
                                <span v-for="(value, key) in user_formation_analysis_by_eltype" v-if="key != 1">
                                    {{ rounded(value.avg_pick,2)  }} <span v-if="key != 4">-</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8">
                            <span class="d-block border-below-orange">Performance per formation type (after auto-sub)</span>
                            <table class="table table-sm text-white table-striped text-small m-data-table mt-1 mb-1 custom-table-responsive" id="formation_analysis_sum_table" v-if="ready">
                                <thead>
                                    <tr>
                                        <th class="text-center">Formation</th>
                                        <th class="text-center">Picked</th>
                                        <th class="text-center">Points</th>
                                        <th class="text-center">Average Pts</th>
                                    </tr>
                                </thead>
                                <tbody v-cloak>
                                    <tr v-for="value in user_formation_analysis_by_gw.sorted" class="owned-row">
                                        <td class="text-center">{{ value.formation }}</td>
                                        <td class="text-center">{{ value.count }}</td>
                                        <td class="text-center">{{ value.points }}</td>
                                        <td class="text-center">{{ rounded(value.avg, 2) }}</td>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="graph-section-wrapper">
        <div class="col-12 mb-3">
            <div class="card card-field border-dark bg-squad-card text-white">
                <h5 class="card-header border-complement text-center scenario_title">Export</h5>
                <div class="card-body" v-if="ready" v-cloak>
                    <div class="row justify-content-center mb-3">
                        <button class="btn btn-secondary mr-2" onclick="export_raw_data()">Download Raw Data</button>
                        <button class="btn btn-info mr-2" onclick="export_all_data()">Download Extended Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    


    <!-- user_stats_per_gw -->

    <div class="row" v-cloak>
        <div class="col-12 mb-3">
            <div class="card border-dark bg-squad-card text-white qa">
                <!-- <div class="card-body text-left">
                    <h5>Note</h5>
                    <p>Data on this page is refreshed every 6 hours. It is possible that some values/graphs do not function properly while a GW is ongoing.</p>
                </div> -->
                <div class="card-footer text-white disclaimer">
                    The information contained on this website is for general information purposes only. Any reliance you place on this information is strictly at your own risk.
                </div>
            </div>
        </div>
    </div>

</main>

<script>
    let ts = ** ts **
</script>


"% with scripts=["main", "sampling_utils", "highlights"] %" "% include 'footer.html' %" "% endwith %"